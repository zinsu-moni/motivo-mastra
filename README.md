# Motivo Mastra — Motivation AI

This project is a Mastra-based assistant that gives short motivational messages tailored to a user's prompt. It was adapted from a weather example and now provides motivational responses via an Agent, Tool, Scorers, and a Workflow.

## What this repo contains

- `src/mastra/agents/motivation-agent.ts` — Agent definition and instructions.
- `src/mastra/tools/motivation-tool.ts` — Local tool that returns short motivational messages (id: `generate-motivation`).
- `src/mastra/scorers/motivation-scorer.ts` — Scorers including a tone scorer and a tool-call appropriateness scorer.
- `src/mastra/workflows/motivation-workflow.ts` — Workflow that invokes the agent to produce a motivational message for a prompt.
- `workflow/motivation-workflow.json` — A workflow JSON (A2A-style) that points to the project `motivationAgent` for importing into Mastra UI/deployments.
- `.mastra/` — build output (auto-generated by `mastra build`).

## Quick start (development)

Requirements:
- Node.js (>= 20.9.0)
- `npm` installed

Install dependencies (if needed):

```powershell
npm install
```

Run Mastra in dev mode (hot reload, UI if available):

```powershell
npm run dev
```

Build for production (generates `.mastra` compiled output):

```powershell
npm run build
```

Start the built project:

```powershell
npm run start
```

The project uses the `mastra` CLI configured in `package.json` scripts. If you run into build issues, see Troubleshooting below.

## How it works (high level)

- The `motivationTool` (tool id `generate-motivation`) provides deterministic, local motivational templates based on a prompt.
- The `motivationAgent` uses a model and the tool to craft responses; it also registers scorers for tool-appropriateness, completeness, and tone.
- The `motivationWorkflow` defines a simple workflow that accepts a `prompt` input and returns a `message` output.
- The `workflow/motivation-workflow.json` file is a UI/deployment-friendly representation (A2A node) you can import into Mastra cloud/workflow UIs.

## Test the workflow locally

1. Start dev server:

```powershell
npm run dev
```

2. Open the Mastra UI (if available) or import `workflow/motivation-workflow.json` into your Mastra deployment dashboard.

3. If you expose A2A endpoints, the node URL will look like:

```
https://<your-mastra-host>/a2a/agent/motivationAgent
```

(If running locally, your host/port may differ. Replace with the correct host.)

Note: exact A2A endpoints and their payload format depend on your Mastra deployment. Use the Mastra UI or API docs for your deployment to call the agent directly.

## Troubleshooting

1. Build fails with a locked `.mastra/mastra.db` (EBUSY):
   - This happens when a running process (often `node`/`mastra dev`) holds files open.
   - Stop running Node/Mastra processes, remove the `.mastra` cache, and rebuild.

PowerShell commands to stop Node processes and clean the cache:

```powershell
# Inspect running node processes
Get-Process -Name node -ErrorAction SilentlyContinue | Select-Object Id, ProcessName, Path | Format-Table -AutoSize

# Stop specific Node PIDs you identify as safe to stop (replace IDs)
Stop-Process -Id 6684,20976 -Force

# Or stop all node processes (use with caution)
Get-Process -Name node -ErrorAction SilentlyContinue | Stop-Process -Force

# Remove the locked DB and cached compiled output, then rebuild
Remove-Item -LiteralPath .mastra\mastra.db -Force -ErrorAction SilentlyContinue
Remove-Item -LiteralPath .mastra -Recurse -Force -ErrorAction SilentlyContinue
npm run build
```

2. Runtime error "Cannot read properties of undefined (reading '_zod')":
   - Often caused by stale or inconsistent compiled output in `.mastra` (e.g., mixing old weather artifacts with new motivation code) or schema/tool id mismatches.
   - Fixes:
     - Clean `.mastra` and re-run `npm run build` (see commands above).
     - Ensure tool ids match between tools and scorers. Example: if your tool id is `generate-motivation`, the scorer's `expectedTool` must use the same string.

## Developer notes

- Tool id consistency: the `motivationTool` is defined with `id: 'generate-motivation'`. Update `motivation-scorer.ts` to match this id (`expectedTool: 'generate-motivation'`).
- If you want more advanced generation, you can replace `motivationTool`'s simple template function with a call to an external LLM API — but add configuration for API keys and error handling.
- Consider adding a `tsconfig.json` (minimal) so you can run `npx tsc --noEmit` locally as a quick static check.

## Suggested next steps

- Add a small example script that programmatically calls the workflow using the Mastra API (if you want, I can add a runnable `scripts/run-motivation.js`).
- Add unit tests for `motivationTool.generateMotivation` and `motivation-scorer` logic.
- Add a short README section describing how to import `workflow/motivation-workflow.json` into your Mastra UI or cloud account (I can add step-by-step instructions for your specific deployment if you share the target host).

## Contributing

Feel free to open PRs. Before submitting:
- Run `npm run build` and ensure `.mastra` recompiles cleanly.
- Keep tool ids and scorer `expectedTool` strings synchronized.

---

If you want, I can also:
- add a `tsconfig.json` and run a type check,
- add a short `scripts/run-motivation.js` that demonstrates invoking the workflow,
- or update the workflow JSON `nodes[0].url` to point to your local/dev Mastra endpoint. Just tell me which you'd like next.
